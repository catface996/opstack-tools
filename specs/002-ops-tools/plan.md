# Implementation Plan: Operations Tools Collection

**Branch**: `002-ops-tools` | **Date**: 2025-12-27 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-ops-tools/spec.md`

## Summary

This feature adds 19 pre-built operational tools to the AIOps Tools platform, organized into four categories: Kubernetes (K8S), Database, Java Application, and AWS Cloud. These tools enable LLM agents to perform common DevOps and SRE tasks through the existing tool execution framework, following the platform's POST-only API pattern and OpenAI function calling format.

## Technical Context

**Language/Version**: Python 3.11+
**Primary Dependencies**: FastAPI, SQLModel, kubernetes, psycopg2, mysql-connector-python, boto3, httpx
**Storage**: PostgreSQL 15+ (tool definitions), Redis 7+ (caching)
**Testing**: pytest with pytest-asyncio
**Target Platform**: Linux server (Docker containers)
**Project Type**: Web API (backend only)
**Performance Goals**: Tool execution within 30 seconds, API response within 5 seconds for non-execution endpoints
**Constraints**: Read-only operations by default, 30s execution timeout, JSON input/output
**Scale/Scope**: 19 tools across 4 categories, integrated with existing tool management system

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Implementation |
|-----------|--------|----------------|
| **I. URL Convention** | ✅ PASS | All tools exposed via `/api/tools/v1/llm/invoke` endpoint |
| **II. POST-Only API** | ✅ PASS | Tool invocation uses POST with JSON body `{"tool_name": "...", "arguments": {...}}` |
| **III. Tool Execution Safety** | ✅ PASS | 30s timeout, subprocess isolation, `main(input_data: dict) -> dict` entry point |
| **IV. LLM Compatibility** | ✅ PASS | All tools have `input_schema` as JSON Schema, snake_case names, clear descriptions |

**Gate Status**: PASSED - All constitution principles are satisfied.

## Project Structure

### Documentation (this feature)

```text
specs/002-ops-tools/
├── plan.md              # This file
├── spec.md              # Feature specification
├── research.md          # Phase 0: Research findings
├── data-model.md        # Phase 1: Data model documentation
├── quickstart.md        # Phase 1: Getting started guide
├── contracts/           # Phase 1: API contracts
│   └── openapi.yaml     # OpenAPI specification for tool endpoints
├── checklists/          # Quality checklists
│   └── requirements.md  # Specification quality checklist
└── tasks.md             # Phase 2: Implementation tasks (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
src/aiops_tools/
├── api/v1/
│   ├── endpoints/
│   │   ├── llm.py           # LLM tool discovery and invocation
│   │   └── tools.py         # Tool and category management
│   └── router.py            # API routing
├── core/
│   ├── config.py            # Application configuration
│   ├── database.py          # Database connection
│   └── redis.py             # Redis connection
├── models/
│   ├── base.py              # SQLModel base
│   └── tool.py              # Tool, ToolCategory, ToolExecution models
├── schemas/
│   ├── llm.py               # LLM API schemas
│   └── tool.py              # Tool API schemas
├── services/
│   ├── tool_executor.py     # Script execution engine
│   ├── tool_validator.py    # Tool validation
│   └── tool_loader.py       # Tool definition loader
├── tools/                   # Operations tools (this feature)
│   ├── k8s/                 # Kubernetes tools
│   │   ├── list_pods.py
│   │   ├── get_logs.py
│   │   ├── describe_pod.py
│   │   ├── restart_deployment.py
│   │   ├── list_namespaces.py
│   │   └── get_deployment_status.py
│   ├── database/            # Database tools
│   │   ├── execute_query.py
│   │   ├── list_tables.py
│   │   ├── describe_table.py
│   │   └── query_validator.py
│   ├── java/                # Java/JMX tools
│   │   ├── get_heap_usage.py
│   │   ├── get_thread_dump.py
│   │   ├── get_gc_stats.py
│   │   └── list_mbeans.py
│   └── aws/                 # AWS tools
│       ├── list_ec2_instances.py
│       ├── describe_instance.py
│       ├── list_s3_buckets.py
│       ├── list_s3_objects.py
│       ├── describe_rds.py
│       └── get_cloudwatch_metrics.py
└── main.py                  # FastAPI application entry

scripts/
├── seed_categories.py       # Seed tool categories
└── seed_tools.py            # Seed tool definitions

tests/
├── unit/                    # Unit tests
├── integration/             # Integration tests
└── contract/                # Contract tests
```

**Structure Decision**: Single web API project structure, with tools organized in `src/aiops_tools/tools/` by category. Tools are defined as Python modules with `TOOL_DEFINITION` dict and `main()` function.

## Tool Inventory

### K8S Tools (6 tools)

| Tool Name | Description | Input Parameters |
|-----------|-------------|------------------|
| `k8s_list_pods` | List pods in a namespace | namespace, label_selector (optional) |
| `k8s_get_logs` | Get pod logs | namespace, pod_name, container (optional), tail_lines |
| `k8s_describe_pod` | Get pod details | namespace, pod_name |
| `k8s_restart_deployment` | Restart a deployment | namespace, deployment_name |
| `k8s_list_namespaces` | List all namespaces | - |
| `k8s_get_deployment_status` | Get deployment status | namespace, deployment_name |

### Database Tools (3 tools)

| Tool Name | Description | Input Parameters |
|-----------|-------------|------------------|
| `db_execute_query` | Execute read-only SQL | db_type, host, port, database, username, password, query |
| `db_list_tables` | List database tables | db_type, host, port, database, username, password, schema (optional) |
| `db_describe_table` | Describe table schema | db_type, host, port, database, username, password, table_name |

### Java Tools (4 tools)

| Tool Name | Description | Input Parameters |
|-----------|-------------|------------------|
| `java_get_heap_usage` | Get JVM heap memory | jolokia_url |
| `java_get_thread_dump` | Get thread dump | jolokia_url |
| `java_get_gc_stats` | Get GC statistics | jolokia_url |
| `java_list_mbeans` | List available MBeans | jolokia_url, domain (optional) |

### AWS Tools (6 tools)

| Tool Name | Description | Input Parameters |
|-----------|-------------|------------------|
| `aws_list_ec2_instances` | List EC2 instances | region, filters (optional), access_key_id (optional), secret_access_key (optional) |
| `aws_describe_instance` | Describe EC2 instance | region, instance_id, access_key_id (optional), secret_access_key (optional) |
| `aws_list_s3_buckets` | List S3 buckets | access_key_id (optional), secret_access_key (optional) |
| `aws_list_s3_objects` | List S3 objects | bucket_name, prefix (optional), max_keys, access_key_id (optional), secret_access_key (optional) |
| `aws_describe_rds` | Describe RDS instance | region, db_instance_identifier, access_key_id (optional), secret_access_key (optional) |
| `aws_get_cloudwatch_metrics` | Get CloudWatch metrics | region, namespace, metric_name, dimensions, start_time (optional), end_time (optional), period, statistic, access_key_id (optional), secret_access_key (optional) |

## Complexity Tracking

No constitution violations requiring justification.
